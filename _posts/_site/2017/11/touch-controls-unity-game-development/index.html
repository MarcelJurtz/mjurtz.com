<p>Some time ago, I created <a href="https://github.com/MarcelJurtz/Escape">this game</a> (<a href="https://marceljurtz.github.io/Escape-Web/">online playable version</a>) in Unity, and I wanted to be able to play it on my Android phone. Since the input options on the smartphone are slightly different from those on the pc, a certain amount of adjustments were necessary. I won’t go over the specific details on the game mechanics, you can check out these on GitHub, they are described in the README file. However, the basic concept of the game is  the movement of a cube to one of the directions up, down, left or right. The information about which direction to use is displayed on the screen.</p>

<p>On a PC, you would use your arrow keys to move the cube. Using Android, you don’t have any keys available. Instead, there is a touchscreen. So you need a way to receive information about user interaction on the touchscreen. Therefore, I’ve created the script <em>GestureRecognizer</em>, which can be seen in the listing below.</p>

<p>The script fetches user input at the first contact, which is saved in the <em>isTouching</em> boolean. The script checks every frame, if the user is touching the screen. If so, it also checks if the user has moved the position on the screen. I use <em>Input.touches</em> for this, since it is an array which contains information about the movement on the screen. All that is left to do now is to check, in which direction the user moved his finger.</p>

<p>However, the immediate evaluation is difficult, as the player will often carry out a minimal movement in a different direction than the intended one (just try it out). For this reason, I have defined a minimum distance that must be exceeded before the script actually communicates the movement. The current movements distance is saved in <em>SwipeDelta</em>, the minimal distance is saved in <em>SWIPE_TOLERANCE</em>, which is assigned 200 units.</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">GestureRecognizer</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kt">bool</span> <span class="n">tap</span><span class="p">,</span> <span class="n">swipeLeft</span><span class="p">,</span> <span class="n">swipeRight</span><span class="p">,</span> <span class="n">swipeUp</span><span class="p">,</span> <span class="n">swipeDown</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">isTouching</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Vector2</span> <span class="n">swipeStart</span><span class="p">,</span> <span class="n">swipeDelta</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">SWIPE_TOLERANCE</span> <span class="p">=</span> <span class="m">200</span><span class="p">;</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">resetSwipePosition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">swipeStart</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
        <span class="n">swipeDelta</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
        <span class="n">isTouching</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">Vector2</span> <span class="n">SwipeDelta</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">swipeDelta</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">SwipeLeft</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">swipeLeft</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">SwipeRight</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">swipeRight</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">SwipeUp</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">swipeUp</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">SwipeDown</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">swipeDown</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">Tap</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">tap</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">tap</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">swipeLeft</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">swipeRight</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">swipeUp</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="n">swipeDown</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">// Mobile Inputs
</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">touches</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">touches</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">phase</span> <span class="p">==</span> <span class="n">TouchPhase</span><span class="p">.</span><span class="n">Began</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">tap</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="n">isTouching</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="n">swipeStart</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">touches</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">position</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">touches</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">phase</span> <span class="p">==</span> <span class="n">TouchPhase</span><span class="p">.</span><span class="n">Ended</span> <span class="p">||</span> <span class="n">Input</span><span class="p">.</span><span class="n">touches</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">phase</span> <span class="p">==</span> <span class="n">TouchPhase</span><span class="p">.</span><span class="n">Ended</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">isTouching</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                <span class="nf">resetSwipePosition</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Distance Calculation
</span>
        <span class="n">swipeDelta</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isTouching</span> <span class="p">&amp;&amp;</span> <span class="n">Input</span><span class="p">.</span><span class="n">touches</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">swipeDelta</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">touches</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">position</span> <span class="p">-</span> <span class="n">swipeStart</span><span class="p">;</span>         
        <span class="p">}</span>

        <span class="c1">// Swipe Recognition
</span>
        <span class="k">if</span><span class="p">(</span><span class="n">swipeDelta</span><span class="p">.</span><span class="n">magnitude</span> <span class="p">&gt;</span> <span class="n">SWIPE_TOLERANCE</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">float</span> <span class="n">x</span> <span class="p">=</span> <span class="n">swipeDelta</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">y</span> <span class="p">=</span> <span class="n">swipeDelta</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

            <span class="k">if</span><span class="p">(</span><span class="n">Mathf</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">&gt;</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="c1">// Left or Right
</span>
                <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">swipeLeft</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">swipeRight</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">// Up or Down
</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">swipeDown</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">swipeUp</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nf">resetSwipePosition</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>To be able to move the cube with this script, it needs to be added to the Update() method of the cubes controller script. To support both touchscreen and keyboards, I simply add an <em>or</em> operator to the if statement:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">if</span> <span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetKeyDown</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">UpArrow</span><span class="p">)</span> <span class="p">||</span> <span class="n">swipeControls</span><span class="p">.</span><span class="n">SwipeUp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...
</span>
<span class="p">}</span></code></pre></figure>

<p>SwipeControls is simply an instance of the above created <em>GestureRecognizer</em> class.</p>

<p>And that’s basically it! To release a game for android, you have to select the <em>Android</em> entry under <em>File</em> – <em>Build Settings</em> and then click <em>Build</em>. If you have an emulator running or your phone (with USB-debugging enabled) connected to your PC, you can directly run the game on the device. Note, that for building apps for Android, you’ll need to have the Android SDK installed, which can be downloaded directly in Unity.</p>
