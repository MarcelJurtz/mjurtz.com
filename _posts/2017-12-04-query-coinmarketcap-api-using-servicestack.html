---
layout: post
title: Query Coinmarketcap API using ServiceStack
date: 2017-12-04 21:45:36.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- CSharp
tags:
- ".NET"
- Bitcoin
- Cryptocurrency
- CSharp
- Development
- Programming
- REST
- ServiceStack
meta:
  _edit_last: '2'
  _adinserter_block_exceptions: ''
  _yoast_wpseo_content_score: '90'
  _yoast_wpseo_primary_category: '42'
  _yoast_wpseo_focuskw_text_input: Coinmarketcap
  _yoast_wpseo_focuskw: Coinmarketcap
  _yoast_wpseo_metadesc: This article covers how to use the ServiceStack C#-Client
    to fetch data from third party REST-APIs, based on an exemplary request to coinmarketcap.
  _yoast_wpseo_linkdex: '83'
  _wpas_done_all: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"8f6677c9d6b0f903e98ad32ec61f8deb";a:2:{s:7:"expires";i:1515559765;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:544;}i:1;a:1:{s:2:"id";i:619;}i:2;a:1:{s:2:"id";i:639;}}}}
author:
  login: Marcel
  email: marcel@mjurtz.com
  display_name: Marcel Jurtz
  first_name: Marcel
  last_name: Jurtz
---
<p>In the <a href="https://blog.mjurtz.com/2017/11/what-is-servicestack/">first article of my series on using ServiceStack</a> I mentioned the feature of the framework that the individual components can be used independently of each other.</p>
<p>This short article is intended as an example of how the C# client can be used separately from a custom service to communicate with third-party APIs. If you would like to know more about the client specifically, you can read <a href="https://blog.mjurtz.com/2017/11/servicestack-using-the-c-client/">my article on this feature</a>.</p>
<h2>Idea ...</h2>
<p>I would like to use <a href="https://coinmarketcap.com/">coinmarketcap.com</a>'s API to access statistics on different crypto currencies. The API documentation is available on the <a href="https://coinmarketcap.com/api/">projects website</a>. Within the scope of this article, there are two things I want to achieve: Querying all available currency data, which contains the 100 strongest crypto currencies in terms of turnover, as well as the targeted query of a single currency.</p>
<p>We receive all the necessary information from the docs. These are the paths of the service as well as the structure of the objects we'd like to receive.</p>
<p>I have decided to use Bitcoin as an example, which leads to the following two paths for use in the project:</p>
<ul>
<li><a href="https://api.coinmarketcap.com/v1/ticker/bitcoin/">api.coinmarketcap.com/v1/ticker/bitcoin/</a></li>
<li><a href="https://api.coinmarketcap.com/v1/ticker/">api.coinmarketcap.com/v1/ticker/</a></li>
</ul>
<h2>... And Execution</h2>
<p>Since we have no influence on the objects we receive from api, we have to adapt a class accordingly. In order to be able to design the properties according to my own ideas, I use the attributes [DataContract] and [DataMember], so that the properties do not have to be named identically to those of the API.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="csharp">[DataContract]
public class CoinDTO
{
    [DataMember(Name = "id")]
    public String Id { get; set; }

    [DataMember(Name = "name")]
    public String Name { get; set; }

    [DataMember(Name = "symbol")]
    public String Symbol { get; set; }

    [DataMember(Name = "rank")]
    public String Rank { get; set; }

    [DataMember(Name = "price_usd")]
    public String PriceUsd { get; set; }

    [DataMember(Name = "price_btc")]
    public String PriceBtc { get; set; }

    [DataMember(Name = "24h_volume_usd")]
    public String VolumeUsd24h { get; set; }

    [DataMember(Name = "market_cap_usd")]
    public String MarketCapUsd { get; set; }

    [DataMember(Name = "available_supply")]
    public String AvailableSupply { get; set; }

    [DataMember(Name = "total_supply")]
    public String TotalSupply { get; set; }

    [DataMember(Name = "percent_change_1h")]
    public String PercentChange1h { get; set; }

    [DataMember(Name = "percent_change_24h")]
    public String PercentChange24h { get; set; }

    [DataMember(Name = "percent_change_7d")]
    public String PercentChange7d { get; set; }

    [DataMember(Name = "last_updated")]
    public String LastUpdated { get; set; }
}</pre>
<p>And that was actually the most complicated part. To obtain the data through the API, I directly specify the corresponding paths from the documentation, since we do not use request DTOs.</p>
<pre class="EnlighterJSRAW" data-enlighter-language="null">public class APIClient
{
    private const String SERVICE_URL = "https://api.coinmarketcap.com/v1/ticker/";

    public List&lt;CoinDTO&gt; GetAllCurrencies()
    {
        List&lt;CoinDTO&gt; response;
        using (var client = new JsonServiceClient(SERVICE_URL))
        {
            response = client.Get&lt;List&lt;CoinDTO&gt;&gt;("/");
        }
        return response;
    }

    public CoinDTO GetBitcoin()
    {
        List&lt;CoinDTO&gt; response;
        using (var client = new JsonServiceClient(SERVICE_URL))
        {
            response = client.Get&lt;List&lt;CoinDTO&gt;&gt;("/bitcoin");
        }
        return response[0];
    }
}</pre>
<p>Since the API always returns an array, I simply return the first element from the Bitcoin queries response. As promised, the implementation of an external service with the ServiceStack Client is quick and easy as usual. The concluding image shows the result of the query.</p>
<p><img src="{{ site.baseurl }}/assets/API_BreakPoint.png" alt="ServiceStack Client - CoinMarketCap Response" width="497" height="409" class="aligncenter size-full wp-image-617" /></p>
