<p>In the <a href="https://blog.mjurtz.com/2017/11/what-is-servicestack/">first article of my series on using ServiceStack</a> I mentioned the feature of the framework that the individual components can be used independently of each other.</p>

<p>This short article is intended as an example of how the C# client can be used separately from a custom service to communicate with third-party APIs. If you would like to know more about the client specifically, you can read <a href="https://blog.mjurtz.com/2017/11/servicestack-using-the-c-client/">my article on this feature</a>.</p>

<h2 id="idea-">Idea …</h2>

<p>I would like to use <a href="https://coinmarketcap.com/">coinmarketcap.com</a>‘s API to access statistics on different crypto currencies. The API documentation is available on the <a href="https://coinmarketcap.com/api/">projects website</a>. Within the scope of this article, there are two things I want to achieve: Querying all available currency data, which contains the 100 strongest crypto currencies in terms of turnover, as well as the targeted query of a single currency.</p>

<p>We receive all the necessary information from the docs. These are the paths of the service as well as the structure of the objects we’d like to receive.</p>

<p>I have decided to use Bitcoin as an example, which leads to the following two paths for use in the project:</p>

<ul>
  <li><a href="https://api.coinmarketcap.com/v1/ticker/bitcoin/">api.coinmarketcap.com/v1/ticker/bitcoin/</a></li>
  <li><a href="https://api.coinmarketcap.com/v1/ticker/">api.coinmarketcap.com/v1/ticker/</a></li>
</ul>

<h2 id="-and-execution">… And Execution</h2>

<p>Since we have no influence on the objects we receive from api, we have to adapt a class accordingly. In order to be able to design the properties according to my own ideas, I use the attributes [DataContract] and [DataMember], so that the properties do not have to be named identically to those of the API.</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="na">[DataContract]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CoinDTO</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"id"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"name"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"symbol"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">Symbol</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"rank"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">Rank</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"price_usd"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">PriceUsd</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"price_btc"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">PriceBtc</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"24h_volume_usd"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">VolumeUsd24h</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"market_cap_usd"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">MarketCapUsd</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"available_supply"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">AvailableSupply</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"total_supply"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">TotalSupply</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"percent_change_1h"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">PercentChange1h</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"percent_change_24h"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">PercentChange24h</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"percent_change_7d"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">PercentChange7d</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">DataMember</span><span class="p">(</span><span class="n">Name</span> <span class="p">=</span> <span class="s">"last_updated"</span><span class="p">)]</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">LastUpdated</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And that was actually the most complicated part. To obtain the data through the API, I directly specify the corresponding paths from the documentation, since we do not use request DTOs.</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">APIClient</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="n">String</span> <span class="n">SERVICE_URL</span> <span class="p">=</span> <span class="s">"https://api.coinmarketcap.com/v1/ticker/"</span><span class="p">;</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">CoinDTO</span><span class="p">&gt;</span> <span class="nf">GetAllCurrencies</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="n">CoinDTO</span><span class="p">&gt;</span> <span class="n">response</span><span class="p">;</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JsonServiceClient</span><span class="p">(</span><span class="n">SERVICE_URL</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">response</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">Get</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">CoinDTO</span><span class="p">&gt;&gt;(</span><span class="s">"/"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">CoinDTO</span> <span class="nf">GetBitcoin</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">List</span><span class="p">&lt;</span><span class="n">CoinDTO</span><span class="p">&gt;</span> <span class="n">response</span><span class="p">;</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JsonServiceClient</span><span class="p">(</span><span class="n">SERVICE_URL</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">response</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">Get</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">CoinDTO</span><span class="p">&gt;&gt;(</span><span class="s">"/bitcoin"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Since the API always returns an array, I simply return the first element from the Bitcoin queries response. As promised, the implementation of an external service with the ServiceStack Client is quick and easy as usual. The concluding image shows the result of the query.</p>

<p><img src="/assets/2017/coinmarketcap_api_servicestack.png" alt="Coinmarketcap API with ServiceStack" /></p>
