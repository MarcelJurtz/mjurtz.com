<p>Traditionally, you were using a listview to display several homogeneous elements in you Android app. However, this view is now deprecated. Android now offers an alternative, which aims to increase performance by only loading those elements, that are currently rendered on-screen: the <em>RecyclerView</em>.</p>

<p>This article shows you how to get started with the RecyclerView. To make things a bit more interesting, we will be using Kotlin instead of Java.</p>

<p>You can set up an Android project for Kotlin by simply clicking the checkbox for Kotlin support in the new project wizard.</p>

<h2 id="preceding-configuration">Preceding Configuration</h2>

<p>Before you can use the Recyclerview in your app, a little preparatory work is necessary. The first thing you’ll need to do is to add this dependency to your modules build.gradle file:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">implementation 'com.android.support:recyclerview-v7:26.1.0'</code></pre></figure>

<h2 id="basic-gui-setup">Basic GUI Setup</h2>

<p>The next thing you’ll want to do is to set up a simple xaml page to display the view. I’ll be using a coordinator layout, which allows me to add a FloatingActionButton at a later stage.</p>

<p>The snippets I use in this article are from my ShoppingList-App, which is basically a minimalistic app to save shopping lists. The user can add and remove items from shopping lists, multiple shopping lists can be used at the same time.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;android.support.design.widget.CoordinatorLayout</span>  <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">tools:context=</span><span class="s">"com.jurtz.marcel.shoppinglist.MainActivity"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;android.support.v7.widget.RecyclerView</span>
        <span class="na">android:id=</span><span class="s">"@+id/rvShoppingLists"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_margin=</span><span class="s">"8dp"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/android.support.design.widget.CoordinatorLayout &gt;</span></code></pre></figure>

<h2 id="recyclerview-components-adapter--viewholder">RecyclerView Components: Adapter &amp; ViewHolder</h2>

<p>While it offers the advantage of improved performance, the RecyclerView is a bit more complicated to create and requires additional components. In our <em>MainActivity</em> class, the first thing to do now is to specify the RecyclerViews LayoutManager. This is required to define the appearance of the multiple items. I’d like to display them in a vertical list.</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="n">rvShoppingLists</span><span class="p">.</span><span class="n">layoutManager</span> <span class="p">=</span> <span class="n">LinearLayoutManager</span><span class="p">(</span><span class="k">this</span><span class="p">)</span></code></pre></figure>

<p>The next thing you’ll want to do is to set the views adapter. You can think of the adapter as a bridge between view and model which defines the appearance of your the POJOs.</p>

<p>To implement the adapter, add a new class which inherits from _RecyclerView.Adapter<T>_. As you can see, this class is generic and requires a ViewHolder, I&#8217;ve also created a custom class for this purpose. The following snippet shows the methods that need to be overridden.</T></p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="kd">class</span> <span class="nc">ShoppingListAdapter</span><span class="p">(</span><span class="kd">var</span> <span class="py">shoppingLists</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ShoppingList</span><span class="p">?&gt;)</span> <span class="p">:</span> <span class="n">RecyclerView</span><span class="p">.</span><span class="n">Adapter</span><span class="p">&lt;</span><span class="n">ShoppingListViewHolder</span><span class="p">&gt;()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="n">getItemCount</span><span class="p">():</span> <span class="n">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="m">5</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">:</span> <span class="n">ShoppingListViewHolder</span><span class="p">?,</span> <span class="n">position</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">parent</span><span class="p">:</span> <span class="n">ViewGroup</span><span class="p">?,</span> <span class="n">viewType</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">ShoppingListViewHolder</span> <span class="p">{</span>
        
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">ShoppingListViewHolder</span><span class="p">(</span><span class="kd">val</span> <span class="py">view</span><span class="p">:</span> <span class="n">View</span><span class="p">)</span> <span class="p">:</span> <span class="n">RecyclerView</span><span class="p">.</span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="p">{</span>
   

<span class="p">}</span></code></pre></figure>

<p>Note that I added <em>5</em> as return value for <em>getItemCount()</em>, you can leave this for now, we will see what this does in the next steps.</p>

<h2 id="custom-layout-for-recyclerview-items">Custom Layout for RecyclerView Items</h2>

<p>Now, we will add a new layout file (xml) to specify how each row in the RecyclerView should look like. For this purpose, I’d like to use a CardView with a nested LinearLayout that contains two TextViews. In my app, I’m using the first TextView to display a shopping lists description and the amount of items in the second one.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;android.support.v7.widget.CardView</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">xmlns:card_view=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">android:id=</span><span class="s">"@+id/cvRowEntry"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
    <span class="na">card_view:cardCornerRadius=</span><span class="s">"4dp"</span>
    <span class="na">android:layout_margin=</span><span class="s">"8dp"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;LinearLayout</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
        <span class="na">android:orientation=</span><span class="s">"vertical"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;TextView</span>
            <span class="na">android:id=</span><span class="s">"@+id/lblShoppingListRowItemHeader"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_margin=</span><span class="s">"8dp"</span>
            <span class="na">android:text=</span><span class="s">"@string/rv_shopping_lists_placeholder_title"</span>
            <span class="na">android:textSize=</span><span class="s">"24sp"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;TextView</span>
            <span class="na">android:id=</span><span class="s">"@+id/lblShoppingListRowItemSubheader"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_margin=</span><span class="s">"8dp"</span>
            <span class="na">android:text=</span><span class="s">"@string/rv_shopping_lists_placeholder_subtitle"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/LinearLayout&gt;</span>
<span class="nt">&lt;/android.support.v7.widget.CardView&gt;</span></code></pre></figure>

<p>Now we want to link the view to the RecyclerView in the adapter. To do this, we will update the onCreateViewHolder method we overrode earlier.</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">override</span> <span class="k">fun</span> <span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">parent</span><span class="p">:</span> <span class="n">ViewGroup</span><span class="p">?,</span> <span class="n">viewType</span><span class="p">:</span> <span class="n">Int</span><span class="p">):</span> <span class="n">ShoppingListViewHolder</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">layoutInflater</span> <span class="p">=</span> <span class="n">LayoutInflater</span><span class="p">.</span><span class="n">from</span><span class="p">(</span><span class="n">parent</span><span class="o">?.</span><span class="n">context</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">cellForRow</span> <span class="p">=</span> <span class="n">layoutInflater</span><span class="p">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">shopping_list_row</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ShoppingListViewHolder</span><span class="p">(</span><span class="n">cellForRow</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>This tells the RecyclerView that each row should look like the layout we just created. If you have left the <em>5</em> in the getItemCount()-method, you will see that the view is displayed 5 times when running the app.</p>

<h2 id="adding-real-data">Adding real Data</h2>

<p>Of course, that’s not all we want. Currently, we can display multiple instances of the basic view, but we want to be able to show actual data. This is where the ViewHolder comes in. Usually, you will have access to a collection of objects that will be displayed in the RecyclerView.</p>

<p>In my snippet above, you can see that I already added a <em>List&lt;ShoppingList?&gt;</em> parameter to the adapters constructor. The ShoppingList class basically just contains a description  and a List of ShoppingListItem-objects, that again only have a <em>description</em> field.</p>

<p>The first thing to do now is to update the <em>getItemCount()</em>-method to actually return the amount of available objects:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="k">override</span> <span class="k">fun</span> <span class="n">getItemCount</span><span class="p">():</span> <span class="n">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">shoppingLists</span><span class="p">.</span><span class="n">size</span> <span class="o">?:</span> <span class="m">0</span>
<span class="p">}</span></code></pre></figure>

<p>In the next step, we will link the object to the view, which is done by the following:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="n">holder</span><span class="o">?.</span><span class="n">bindShoppingList</span><span class="p">(</span><span class="n">shoppingList</span> <span class="p">=</span> <span class="n">shoppingLists</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">position</span><span class="p">))</span></code></pre></figure>

<p>And, last but not least, declaring the views properties to the objects variable values:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="kd">class</span> <span class="nc">ShoppingListViewHolder</span><span class="p">(</span><span class="kd">val</span> <span class="py">view</span><span class="p">:</span> <span class="n">View</span><span class="p">)</span> <span class="p">:</span> <span class="n">RecyclerView</span><span class="p">.</span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="n">bindShoppingList</span><span class="p">(</span><span class="n">shoppingList</span><span class="p">:</span> <span class="n">ShoppingList</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">view</span><span class="p">.</span><span class="n">lblShoppingListRowItemHeader</span><span class="p">.</span><span class="n">setText</span><span class="p">(</span><span class="n">shoppingList</span><span class="o">?.</span><span class="n">description</span><span class="p">)</span>

        <span class="kd">var</span> <span class="py">suffix</span> <span class="p">=</span> <span class="s">""</span>
        <span class="kd">var</span> <span class="py">count</span> <span class="p">=</span> <span class="n">shoppingList</span><span class="o">?.</span><span class="n">items</span><span class="o">?.</span><span class="n">size</span> <span class="o">?:</span> <span class="m">0</span>
        <span class="k">if</span><span class="p">(</span><span class="n">count</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">suffix</span> <span class="p">=</span> <span class="n">view</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">resources</span><span class="p">.</span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">rv_shopping_list_items_suffix_single</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">suffix</span> <span class="p">=</span> <span class="n">view</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">resources</span><span class="p">.</span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">rv_shopping_list_items_suffix_multiple</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">view</span><span class="p">.</span><span class="n">lblShoppingListRowItemSubheader</span><span class="p">.</span><span class="n">setText</span><span class="p">(</span><span class="n">count</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span> <span class="p">+</span> <span class="s">" "</span> <span class="p">+</span> <span class="n">suffix</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>That’s it! I added the following code to my MainActivity to test the adapter:</p>

<figure class="highlight"><pre><code class="language-kotlin" data-lang="kotlin"><span class="n">rvShoppingLists</span><span class="p">.</span><span class="n">layoutManager</span> <span class="p">=</span> <span class="n">LinearLayoutManager</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

<span class="kd">var</span> <span class="py">list1</span> <span class="p">=</span> <span class="n">ShoppingList</span><span class="p">()</span>
<span class="n">list1</span><span class="p">.</span><span class="n">description</span> <span class="p">=</span> <span class="s">"Groceries"</span>

<span class="kd">var</span> <span class="py">list2</span> <span class="p">=</span> <span class="n">ShoppingList</span><span class="p">()</span>
<span class="n">list2</span><span class="p">.</span><span class="n">description</span> <span class="p">=</span> <span class="s">"Clothes"</span>

<span class="kd">var</span> <span class="py">list3</span> <span class="p">=</span> <span class="n">ShoppingList</span><span class="p">()</span>
<span class="n">list3</span><span class="p">.</span><span class="n">description</span> <span class="p">=</span> <span class="s">"Stuff for the apartment"</span>

<span class="kd">var</span> <span class="py">list</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="n">list2</span><span class="p">,</span> <span class="n">list3</span><span class="p">)</span>

<span class="n">rvShoppingLists</span><span class="p">.</span><span class="n">adapter</span> <span class="p">=</span> <span class="n">ShoppingListAdapter</span><span class="p">(</span><span class="n">list</span><span class="p">)</span></code></pre></figure>

<p> </p>
