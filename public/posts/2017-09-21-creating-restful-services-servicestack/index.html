<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.88.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Creating RESTful Services with ServiceStack &middot; Marcel Jurtz</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://www.mjurtz.com/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://www.mjurtz.com/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://www.mjurtz.com/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://www.mjurtz.com/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="sidebar-about">
            <a href="https://www.mjurtz.com/">
                <h1>Marcel Jurtz</h1>
            </a>
            <p class="lead">
                 Notes and thoughts on software development 
            </p>
        </div>

        <nav>
            <ul class="sidebar-nav">
                <li><a href="https://www.mjurtz.com/">Home</a> </li>
                <li><a href="/about/"> About </a></li><li><a href="/imprint/"> Imprint / Impressum </a></li><li><a href="/privacy/"> Privacy / Datenschutz </a></li>
            </ul>
        </nav>

    </div>
</aside>
    <main class="content container">
    <div class="post">
  <h1>Creating RESTful Services with ServiceStack</h1>
  <time datetime=2017-09-21T18:00:26Z class="post-date">Thu, Sep 21, 2017</time>
  <p>This articles covers the basic usage of <a href="https://servicestack.net/">ServiceStack</a>, a .NET-framework for creating RESTful services. The framework has a really great <a href="http://docs.servicestack.net/">documentation</a>, where you can check out all the details.</p>
<h2 id="configuration">Configuration</h2>
<p>To get started, you&rsquo;ll want to create a new ASP.NET project, and load the ServiceStack package via NuGet. Then, you&rsquo;ll have to edit your <em>Web.config</em> to look like the following (mentioned versions may differ from your project):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">  Informationen zur Konfiguration Ihrer ASP.NET-Anwendung finden Sie unter
</span><span style="color:#75715e">  https://go.microsoft.com/fwlink/?LinkId=169433
</span><span style="color:#75715e">  --&gt;</span>
<span style="color:#f92672">&lt;configuration&gt;</span>
  <span style="color:#f92672">&lt;system.web&gt;</span>
    <span style="color:#f92672">&lt;compilation</span> <span style="color:#a6e22e">debug=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#a6e22e">targetFramework=</span><span style="color:#e6db74">&#34;4.6.1&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;httpRuntime</span> <span style="color:#a6e22e">targetFramework=</span><span style="color:#e6db74">&#34;4.6.1&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;httpHandlers&gt;</span>
      <span style="color:#f92672">&lt;add</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;*&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;ServiceStack.HttpHandlerFactory, ServiceStack&#34;</span> <span style="color:#a6e22e">verb=</span><span style="color:#e6db74">&#34;*&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/httpHandlers&gt;</span>
  <span style="color:#f92672">&lt;/system.web&gt;</span>
  <span style="color:#75715e">&lt;!-- Required for IIS7 --&gt;</span>
  <span style="color:#f92672">&lt;system.webServer&gt;</span>
    <span style="color:#f92672">&lt;modules</span> <span style="color:#a6e22e">runAllManagedModulesForAllRequests=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;validation</span> <span style="color:#a6e22e">validateIntegratedModeConfiguration=</span><span style="color:#e6db74">&#34;false&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;handlers&gt;</span>
      <span style="color:#f92672">&lt;add</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;*&#34;</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;ServiceStack.Factory&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;ServiceStack.HttpHandlerFactory, ServiceStack&#34;</span> <span style="color:#a6e22e">verb=</span><span style="color:#e6db74">&#34;*&#34;</span> <span style="color:#a6e22e">preCondition=</span><span style="color:#e6db74">&#34;integratedMode&#34;</span> <span style="color:#a6e22e">resourceType=</span><span style="color:#e6db74">&#34;Unspecified&#34;</span> <span style="color:#a6e22e">allowPathInfo=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/handlers&gt;</span>
  <span style="color:#f92672">&lt;/system.webServer&gt;</span>
  <span style="color:#f92672">&lt;system.codedom&gt;</span>
    <span style="color:#f92672">&lt;compilers&gt;</span>
      <span style="color:#f92672">&lt;compiler</span> <span style="color:#a6e22e">language=</span><span style="color:#e6db74">&#34;c#;cs;csharp&#34;</span> <span style="color:#a6e22e">extension=</span><span style="color:#e6db74">&#34;.cs&#34;</span>
        <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Microsoft.CodeDom.Providers.DotNetCompilerPlatform.CSharpCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=1.0.5.0, Culture=neutral, PublicKeyToken=31bf3513ad364e35&#34;</span>
        <span style="color:#a6e22e">warningLevel=</span><span style="color:#e6db74">&#34;4&#34;</span> <span style="color:#a6e22e">compilerOptions=</span><span style="color:#e6db74">&#34;/langversion:default /nowarn:1659;1699;1701&#34;</span><span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;compiler</span> <span style="color:#a6e22e">language=</span><span style="color:#e6db74">&#34;vb;vbs;visualbasic;vbscript&#34;</span> <span style="color:#a6e22e">extension=</span><span style="color:#e6db74">&#34;.vb&#34;</span>
        <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Microsoft.CodeDom.Providers.DotNetCompilerPlatform.VBCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=1.0.5.0, Culture=neutral, PublicKeyToken=31bf3513ad364e35&#34;</span>
        <span style="color:#a6e22e">warningLevel=</span><span style="color:#e6db74">&#34;4&#34;</span> <span style="color:#a6e22e">compilerOptions=</span><span style="color:#e6db74">&#34;/langversion:default /nowarn:41008 /define:_MYTYPE=\&#34;</span><span style="color:#960050;background-color:#1e0010">Web\&#34;</span> <span style="color:#960050;background-color:#1e0010">/optionInfer+&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/compilers&gt;</span>
  <span style="color:#f92672">&lt;/system.codedom&gt;</span>
<span style="color:#f92672">&lt;/configuration&gt;</span>
</code></pre></div><p>The second step is the configuration of the file <em>Global.asax.cs</em>. I&rsquo;ve created a new class <em>HelloAppHost</em> which inherits from <em>AppHostBase</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HelloAppHost</span> : AppHostBase
{
    <span style="color:#66d9ef">public</span> HelloAppHost() : <span style="color:#66d9ef">base</span>(<span style="color:#e6db74">&#34;Hello Web Services&#34;</span>, <span style="color:#66d9ef">typeof</span>(HelloService).Assembly) { }
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">void</span> Configure(Container container)
    {
        SetConfig(<span style="color:#66d9ef">new</span> HostConfig
        {
            DefaultContentType = MimeTypes.Json
        });

        <span style="color:#75715e">// Authentication
</span><span style="color:#75715e"></span>        Plugins.Add(<span style="color:#66d9ef">new</span> AuthFeature(() =&gt; <span style="color:#66d9ef">new</span> AuthUserSession(),
            <span style="color:#66d9ef">new</span> IAuthProvider[] {
                <span style="color:#66d9ef">new</span> CustomCredentialsAuthProvider()
            }
        ));

        Plugins.Add(<span style="color:#66d9ef">new</span> RegistrationFeature());

        container.Register&lt;ICacheClient&gt;(<span style="color:#66d9ef">new</span> MemoryCacheClient());
        <span style="color:#66d9ef">var</span> userRep = <span style="color:#66d9ef">new</span> InMemoryAuthRepository();
        container.Register&lt;IUserAuthRepository&gt;(userRep);
    }
}
</code></pre></div><p>I&rsquo;ve added a authentication functionality, which will be covered later in this post. The other thing I set up, is to return JSON-formatted data as default. The last thing to do in this file is creating an instance of the above class:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> Application_Start(<span style="color:#66d9ef">object</span> sender, EventArgs e)
{
    <span style="color:#66d9ef">var</span> appHost = <span style="color:#66d9ef">new</span> HelloAppHost();
    appHost.Init();
}
</code></pre></div><h2 id="adding-routes">Adding Routes</h2>
<p>After configuring the service, routes can be added. The general structure consists of three elements: RequestDTO, ResponseDTO and a Service. The following example shows how to set up a route following this approach:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#a6e22e">[Route(&#34;/hello/{name*}&#34;)]</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Hello</span> : IReturn&lt;HelloResponse&gt;
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Name { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HelloResponse</span>
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Result { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HelloService</span> : IService
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">object</span> Get(Hello request)
    {
        <span style="color:#66d9ef">var</span> name = request.Name ?? <span style="color:#e6db74">&#34;World&#34;</span>;
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> HelloResponse { Result = <span style="color:#e6db74">$&#34;Hello, {name}!&#34;</span> };
    }
}
</code></pre></div><p>This service responds to requests on _/hello/{name*}_. The curly brackets indicate a variable, the star is a wildcard to indicate, that this variable is optional. This way, the service will also respond if no name is submitted (it will use the default &lsquo;_World&rsquo;_ for the response).</p>
<p>While you can use the notation above to mark routes, you can also set these up in your configuration (<em>Global.asax.cs</em>). Just add the following contents after <em>container.register</em>&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">Routes
    .Add&lt;Hello&gt;(<span style="color:#e6db74">&#34;/hello&#34;</span>)
    .Add&lt;Hello&gt;(<span style="color:#e6db74">&#34;/hello/{Name}&#34;</span>);
</code></pre></div><h2 id="http-verbs">HTTP Verbs</h2>
<p>As shown in the example above, HelloService only implements the method <em>Get()</em>. This can be supplemented or extended by any other HTTP verb or Any, which will then respond to all requests on this path. ServiceStack also has a nice <a href="http://docs.servicestack.net/design-rest-services">documentation</a> about the usage of each verb.</p>
<h2 id="fallback-routes">Fallback Routes</h2>
<p>You can use fallbacks to cover routes, that are not handled explicitly. In my case, I return information about the unhandled path and a timestamp. Again, wildcards are used.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#a6e22e">[FallbackRoute(&#34;/{Path*}&#34;)]</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fallback</span> : IReturn&lt;FallbackResponse&gt;
{
    <span style="color:#66d9ef">public</span> String Path { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FallbackResponse</span>
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Message { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Path { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
    <span style="color:#66d9ef">public</span> String Timestamp { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
}

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FallbackService</span> : IService
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">object</span> Any(Fallback request)
    {
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> FallbackResponse {
            Message = <span style="color:#e6db74">&#34;No matching path specified&#34;</span>,
            Path = request.Path ?? <span style="color:#e6db74">&#34;/&#34;</span>,
            Timestamp = DateTime.Now.ToString()
        };
    }
}
</code></pre></div><h2 id="authentication">Authentication</h2>
<p>The last element I&rsquo;d like to cover is the authentication of a user. ServiceStack offers the class <em>CredentialsAuthProvider</em>, from which custom providers can be derived. The following example covers two methods, TryAuthenticate, which tries to log in by checking username and password against custom logic, and OnAuthenticated, which will be used to assign session variables.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomCredentialsAuthProvider</span> : CredentialsAuthProvider
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">bool</span> TryAuthenticate(IServiceBase authService,
    <span style="color:#66d9ef">string</span> userName, <span style="color:#66d9ef">string</span> password)
    {
        <span style="color:#75715e">// Only checks if username equals password
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// implement custom logic here
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> userName.Equals(password);
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">override</span> IHttpResult OnAuthenticated(IServiceBase authService,
        IAuthSession session, IAuthTokens tokens,
        Dictionary&lt;<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">string</span>&gt; authInfo)
    {
        session.customElement= <span style="color:#e6db74">&#34;Hello World&#34;</span>;
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">base</span>.OnAuthenticated(authService, session, tokens, authInfo);
    }
}
</code></pre></div><p>After creating this functionality, you can try to log in using the <em>/auth</em> route via POST and adding a username and password parameter. If you want any of your routes to require authentication, just add the <em>[Authenticate]</em> attribute above its response (above the [Route&hellip;]). After doing so, requesting this route without earlier authentication will lead to an empty response.</p>
<p>To log out, simply send a request (GET or POST) to <em>/auth/logout</em>.</p>
<h2 id="further-information">Further Information</h2>
<p>As I mentioned above, <a href="http://docs.servicestack.net/">ServiceStacks documentation</a> is really well written and maintained. I don&rsquo;t think you&rsquo;ll need any information besides what you can find there.</p>

</div>


    </main>

    
      
    
  </body>
</html>
